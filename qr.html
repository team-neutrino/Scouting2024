<!DOCTYPE html>
<html lang="en">
  <script src="./app.js"></script>
  <script src="./qrcode.js"></script>


<head>
    <meta charset="UTF-8">
    <title>Qr Code</title>
    <link href="./epicStyle.css" rel="stylesheet" type="text/css"><link>
   <script>
     function initQRCode() {

    console.log('here ', localStorage);
      console.log("fourth");
      qrcode = new QRCode(document.getElementById("qrArea"), {
        text: "",

        width: 300,

        height: 300,

        colorDark: "black",

        colorLight: "white",

        correctLevel: QRCode.CorrectLevel.M,
      });
      console.log(displaySavedData());
      let unparsedActionList = sessionStorage.getItem("actionList");
      let unparsedExtradata = sessionStorage.getItem("extraData");
      let unparsedCompressedList = sessionStorage.getItem("compressedList");
      actionList = JSON.parse(unparsedActionList);
      compressedList = JSON.parse(unparsedCompressedList);
      extraData = JSON.parse(unparsedExtradata);
      console.log(actionList);
      console.log(compressedList);
      console.log(extraData);
      var sums = Array(16).fill(0);
      for (const item of compressedList) {
        sums[item]++;
      }
      
      qrcode.clear();
       qrcode.makeCode("test me")
      qrcode.makeCode(
        extraData[0] +
          "\t" +
          extraData[1] +
          "\t" +
          extraData[2] +
          "\t" +
          //encodeURI(extraData[3]) +
          extraData[3] +
          "\t" +
          extraData[4] +
          "\t" +
          sums.join(",")
      );
    }
    window.onload = () => {
      console.log("first");
      console.log("third");
      initQRCode();
      displayBoxData();
    }; 

    function regenOldQR() {
    var matchToregen = prompt("What Match?");
    var oldCompList = localStorage.getItem("comp" + matchToregen);
    var oldED = localStorage.getItem("ED" + matchToregen);
    OldCompressedList = JSON.parse(oldCompList);
    OldExtraDataList = JSON.parse(oldED);
    console.log('local storage: ', localStorage);
    console.log('oldCompList: ', oldCompList);
    if (OldExtraDataList == null) {
        alert("No match with this number!");
        return;
    }
    qrcode.clear();
    var sums = Array(25).fill(0);  
        for (const item of OldCompressedList) {
          sums[item-1]++;
        }
    qrcode.makeCode(OldExtraDataList[0] + "\t" + OldExtraDataList[1] + "\t" + OldExtraDataList[2] + "\t" + OldExtraDataList[3] + "\t" + OldExtraDataList[4] + "\t" + sums.join(",") + "\r")
    }
    </script>
</head>
<body>
<table class="qrTable">
  <tr class="top">
    <th class="topSideBox">
      <input class="infoBox" type="text" name="teamBox" id="teamNumberBox" readonly/>
    </th>
    <th colspan="3" class="header">Qr Code</th>
    <th class="topSideBox">
      <input class="infoBox" type="text" name="matchBox" id="matchNumberBox" readonly/>
    </th>
  </tr>
  <tr>
    <td></td>
    <td class="qrHolder" colspan="3">
      <div class="qrArea" id="qrArea" ></div>
    </td>
    <td></td>
  </tr>
  <tr class="footer">
    <td>
      <button class="backForth nextColor" id="next" onclick="window.location.href='./endgame2.html'">&larr;</button>
    </td>
    <td colspan="3">
      <button onclick="regenOldQR()" style="background-color: green">Regen QR</button>
    </td>
    <td>
      <button class="reset" onclick="reset()">Reset</button>
    </td>
  </tr>
</table>
</body>
</html>